<!--
Copyright (c) 2014 Long Xiang (seanlong@outlook.com). All rights reserved.
Unauthorized copying of this file, via any medium is strictly prohibited
Proprietary and confidential
-->

<link rel="import" href="./bower_components/core-item/core-item.html">
<link rel="import" href="./bower_components/paper-radio-button/paper-radio-button.html">

<link rel="import" href="./oil-image.html">
<link rel="import" href="./oil-chart.html">

<polymer-element name="small-chart">
    <template>
        <style>
        oil-chart {
            margin: 0px;
            margin-left: 20px;
        }
        </style>
        <oil-chart id="chart" type="small" chart_width="120" , chart_height="50" samples={{samples}}></oil-chart>
    </template>
    <script>
    Polymer({
        publish: {
            category: '' //TODO(xiang): should be oil-height, oil-water...
        },
        ready: function() {
            // TODO(xiang): fetch JSON data from local server.
            this.samples = [];
            for (var i = 0; i < 100; ++i)
                this.samples.push({
                    time: i,
                    value: Math.floor(Math.random() * 100)
                });
        }
    });
    </script>
</polymer-element>

<polymer-element name="oil-tank">
    <template>
        <template if="{{tank_id > 0 && type == 'outline'}}">
            <style>
            .oil-tank {
                margin: 20px 10px 40px 20px;
            }
            oil-image {
                margin-right: 40px;
            }
            .name {
                border-bottom: 4px solid #4caf50;
                font-size: 24px;
                font: bold;
            }
            core-item {
                border-bottom: 1px solid #bdbdbd;
            }
            data {
                margin-left: 4px;
                margin-top: 4px;
            }
            </style>
            <div class='oil-tank' horizontal layout>
                <oil-image type="small" on-click={{onChoose}} curr={{data.oil_level_high/height}}></oil-image>
                <div vertical layout>
                    <div class='name'>#{{tank_id}}号罐</div>
                    <core-item src="images/oil_low.png" label="油面低位: ">
                        <data>{{data.oil_level_low}} m</data>
                    </core-item>
                    <core-item src="images/oil_high.png" label="油面高位: ">
                        <data>{{data.oil_level_high}} m</data>
                    </core-item>
                    <core-item src="images/water.png" label="水面高度: ">
                        <data>{{data.water_level}} m</data>
                    </core-item>
                    <core-item src="images/temperature.png" label="平均温度: ">
                        <data>{{data.temperature}} °C</data>
                    </core-item>
                    <core-item src="images/volume.png" label="油品体积: ">
                        <data>{{data.oil_volume}}
                            <font>m<sup>3</sup>
                            </font>
                        </data>
                    </core-item>
                    <core-item src="images/density.png" label="油品密度: ">
                        <data>{{data.oil_density}} kg/
                            <font>m<sup>3</sup>
                            </font>
                        </data>
                    </core-item>
                    <core-item src="images/weight.png" label="油品质量: ">
                        <data>{{data.oil_weight}} kg</data>
                    </core-item>
                </div>
            </div>
        </template>
        <template if="{{tank_id > 0 && type=='detail'}}">
            <style>
            .oil-tank {
                margin: 50px 0px 0px 50px;
            }
            core-item {
                border-bottom: 1px solid #bdbdbd;
            }
            data {
                margin-left: 4px;
                margin-top: 4px;
            }
            .desc {
                margin-left: 20px;
            }
            .indicator > .title {
                font-size: 18px;
                font-weight: 10px;
                margin-left: 50px;
                margin-right: 20px;
                margin-top: -8px;
                padding: 4px;
                border: 2px solid;
            }
            .indicator > paper-radio-button {
                margin-top: 3px;
                margin-left: 5px;
                margin-right: 15px;
            }
            paper-radio-button::shadow #ink[checked] {
                color: #F44336;
            }
            paper-radio-button::shadow #onRadio {
                background-color: #F44336;
            }
            </style>
            <div class='oil-tank' horizontal layout>
                <oil-image type="large" curr={{data.oil_level_high/height}}></oil-image>
                <div class='desc' vertical layout>
                    <core-item src="images/oil_low.png" label="油面低位: " on-click="{{onChooseCategory}}">
                        <data>{{data.oil_level_low}} m</data>
                        <small-chart></small-chart>
                    </core-item>
                    <core-item src="images/oil_high.png" label="油面高位: " on-click="{{onChooseCategory}}">
                        <data>{{data.oil_level_high}} m</data>
                        <small-chart></small-chart>
                    </core-item>
                    <core-item src="images/water.png" label="水面高度: " on-click="{{onChooseCategory}}">
                        <data>{{data.water_level}} m</data>
                        <small-chart></small-chart>
                    </core-item>
                    <core-item src="images/temperature.png" label="平均温度: " on-click="{{onChooseCategory}}">
                        <data>{{data.temperature}} °C</data>
                        <small-chart></small-chart>
                    </core-item>
                    <core-item src="images/volume.png" label="油品体积: " on-click="{{onChooseCategory}}">
                        <data>{{data.oil_volume}}
                            <font>m<sup>3</sup>
                            </font>
                        </data>
                        <small-chart></small-chart>
                    </core-item>
                    <core-item src="images/density.png" label="油品密度: " on-click="{{onChooseCategory}}">
                        <data>{{data.oil_density}} kg/
                            <font>m<sup>3</sup>
                            </font>
                        </data>
                        <small-chart></small-chart>
                    </core-item>
                    <core-item src="images/weight.png" label="油品质量: " on-click="{{onChooseCategory}}">
                        <data>{{data.oil_weight}} kg</data>
                        <small-chart></small-chart>
                    </core-item>
                </div>
            </div>
            <div class="indicator" layout horizontal>
                <div class="title">
                    <b>预警状态</b>
                </div>
                <b>水位:</b>
                <paper-radio-button id="water_level" disabled></paper-radio-button>
                <b>油位:</b>
                <paper-radio-button id="oil_level" disabled></paper-radio-button>
                <b>温度:</b>
                <paper-radio-button id="temp" disabled></paper-radio-button>
                <b>泄露:</b>
                <paper-radio-button id="leak" disabled></paper-radio-button>
            </div>
        </template>
    </template>
    <script>
    var mock_data = [
        [2.3, 8.5, 1.6, 39.9, 423.5, 810],
        [1.8, 3.7, 1.2, 22.8, 178.6, 812],
        [0.7, 1.2, 0.2, 19.2, 69.5, 822],
        [3.5, 6.9, 3.2, 38.3, 330.5, 812],
        [2.2, 4.5, 2.4, 24.9, 270.5, 811],
        [2.3, 8.5, 1.6, 20.9, 423.5, 810],
    ];
    Polymer({
        created: function() {
            this.height = 10;
            //TODO(xiang): fetch current tank data from server.
        },
        ready: function() {},
        publish: {
            tank_id: -1,
            type: "outline",
        },
        attached: function() {
            var idx = this.tank_id - 1;
            // Fallback for test
            if (idx < 0 || idx > mock_data.length - 1)
                idx = 0;
            this.updateData(idx);
        },
        onChoose: function() {
            this.fire('choose-tank', {
                id: this.tank_id,
            });
        },
        onChooseCategory: function() {},
        tank_idChanged: function(old_id, new_id) {
            var idx = new_id - 1;
            this.updateData(idx);
        },
        updateData: function(idx) {
            this.data = {
                oil_level_low: mock_data[idx][0],
                oil_level_high: mock_data[idx][1],
                water_level: mock_data[idx][2],
                temperature: mock_data[idx][3],
                oil_volume: mock_data[idx][4],
                oil_density: mock_data[idx][5],
                oil_weight: Math.floor(mock_data[idx][4] * mock_data[idx][5]),
            };
            if (!this.$.oil_level || !this.$.water_level || !this.$.temp)
                return;

            // FIXME(xiang): hard code the oil waring threshold
            if (this.data.oil_level_low < 1) {
                this.$.oil_level.disabled = false;
                this.$.oil_level.checked = true;
            } else {
                this.$.oil_level.checked = false;
                this.$.oil_level.disabled = true;
            }

            if (this.data.water_level < 0.5) {
                this.$.water_level.disabled = false;
                this.$.water_level.checked = true;
            } else {
                this.$.water_level.checked = false;
                this.$.water_level.disabled = true;
            }

            if (this.data.temperature > 38) {
                this.$.temp.disabled = false;
                this.$.temp.checked = true;
            } else {
                this.$.temp.checked = false;
                this.$.temp.disabled = true;
            }

        }
    });
    </script>
</polymer-element>
