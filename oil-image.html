<!--
Copyright (c) 2014 Long Xiang (seanlong@outlook.com). All rights reserved.
Unauthorized copying of this file, via any medium is strictly prohibited
Proprietary and confidential
-->

<script type="text/javascript" src="./bower_components/paper.js/paper-full.min.js"></script>

<polymer-element name='oil-image'>
    <template>
        <style>
        </style>
        <canvas id="oil_tank"></canvas>
    </template>
    <script>
    var fillColor = '#90A4AE';
    var strokeColor = '#424242';
    Polymer({
        attached: function() {
            var canvas = this.$.oil_tank;
            if (this.type == "small") {
                canvas.width = 220;
                canvas.height = 240;
            } else if (this.type == "large") {
                canvas.width = 420;
                canvas.height = 460;
            }
            paper.setup(canvas);
            this.items = [];
            this.draw();
        },
        // FIXME(xiang): currently this's a tricky way to draw the color.
        drawInternal: function(top, left, radius, height) {
            function drawDecorator() {
                var step = height / 5;
                var w = 10;
                var path = new paper.Path.Line({
                    from: [left - w, top],
                    to: [left - w, top + height],
                    strokeWidth: 3,
                    strokeColor: strokeColor
                });
                for (var i = 0; i < 6; i++) {
                    var path = new paper.Path.Line({
                        from: [left - w, top + i * step],
                        to: [left, top + i * step],
                        strokeWidth: 3,
                        strokeColor: strokeColor
                    });
                }
            }
            drawDecorator();

            this.items.forEach(function(i) {
                i.remove();
            });
            this.items = [];
            center_x = left + radius[0];
            right = left + radius[0] * 2;
            var bottom_ellipse = new paper.Path.Ellipse({
                center: [center_x, top + height],
                radius: radius,
                strokeColor: strokeColor,
                strokeWidth: 5
            });
            if (this.curr > 0 && this.curr <= 1) {
                var rect = new paper.Shape.Rectangle({
                    topLeft: [left, top + (1 - this.curr) * height],
                    bottomRight: [right, top + height],
                    fillColor: fillColor
                });
                var e1 = new paper.Shape.Ellipse({
                    center: [center_x, top + height],
                    radius: radius,
                    fillColor: fillColor
                });
                var e2 = new paper.Shape.Ellipse({
                    center: [center_x, top + (1 - this.curr) * height],
                    radius: radius,
                    strokeColor: strokeColor,
                    fillColor: fillColor
                });
                this.items.push(rect, e1, e2);
            }
            var top_ellipse = new paper.Path.Ellipse({
                center: [center_x, top],
                radius: radius,
                strokeColor: strokeColor,
                strokeWidth: 4
            });

            var left_border = new paper.Path.Line({
                from: [left, top + 2],
                to: [left, top + height - 3],
                strokeColor: strokeColor,
                strokeWidth: 3
            });
            var right_border = new paper.Path.Line({
                from: [right, top + 2],
                to: [right, top + height - 3],
                strokeColor: strokeColor,
                strokeWidth: 3
            });
            this.items.push(bottom_ellipse, top_ellipse, left_border, right_border);
            paper.view.draw();
        },
        drawSmall: function() {
            this.drawInternal(50, 20, [90, 30], 140);
        },
        drawLarge: function() {
            this.drawInternal(50, 20, [160, 40], 250);
        },
        draw: function() {
            if (this.type == 'small') {
                this.drawSmall();
            } else if (this.type == 'large') {
                this.drawLarge();
            }
        },
        publish: {
            type: 'small',
            curr: -1, //in percentage          
        },
        currChanged: function(old_curr, new_curr) {
            // Avoid remove image when change from -1
            if (old_curr >= 0)
                this.draw();
        }
    });
    </script>
</polymer-element>
